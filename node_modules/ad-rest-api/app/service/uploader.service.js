
let responder = require('../sender/response.sender');
let joi = require('joi');

let uploaderService = {
    uploadFiles: uploadFile,
    deleteUploadedFiles: deleteUploadedFiles
}

module.exports = uploaderService;

function uploadFile(req, res) {

    let uploaderModel = require('../models/uploader.modal');
    joi.validate(req.body, uploaderModel.body, function (err, value) {
        if (err) {
            responder.valiodationFail(res);
        }
        else {
            switch (req.body.module.toLowerCase()) {
                case 'mainslider':
                    let sliderService = require('../service/homepage/slider.service');
                    sliderService.saveSliderImages(req,res, function (err, result) {
                        responder.response(err, result, res);
                    });
                    break;

                default:
                    break;
            }
        }
    });

}

function deleteUploadedFiles(object, res) {
    const fs = require('fs');
    object.forEach(element => {
        fs.unlink(element.path, (err) => {
            if (err) console.log("error in delete uploaded file...");
        });
    });
    responder.invalidLogin(res);
}